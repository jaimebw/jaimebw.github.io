---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("posts");
posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const formatDate = (value: Date) =>
  value.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
---
<BaseLayout title="Home" description="Hola! Qué tal? I'm Jaime">
  <section>
    <h2>Introduction</h2>
    <p>
      Hola! Qué tal? I'm Jaime. I build avionics and software tooling, write about
      ARINC429 obsessions, and keep all of it in a terminal-flavored interface.
    </p>
    <p>
      This site renders the Markdown posts from my old Jekyll blog, now powered by Astro and Bun.
    </p>
  </section>

  <section>
    <h2>Recent posts</h2>
    <table>
      <thead>
        <tr>
          <th class="width-auto">Title</th>
          <th class="width-min">Date</th>
          <th class="width-min">Tags</th>
        </tr>
      </thead>
      <tbody>
        {posts.map((post) => (
          <tr>
            <td>
              <a href={`/${post.slug}/`}>{post.data.title}</a>
              {post.data.subtitle && (
                <>
                  <br />
                  <em>{post.data.subtitle}</em>
                </>
              )}
            </td>
            <td>
              <time datetime={post.data.date.toISOString()}>
                {formatDate(post.data.date)}
              </time>
            </td>
            <td>
              {post.data.tags && post.data.tags.length > 0
                ? post.data.tags.join(", ")
                : "—"}
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  </section>
</BaseLayout>
